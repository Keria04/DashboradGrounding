# 📋 数据增量更新指南 - 快速参考

## 🚀 添加新数据三步走

### Step 1: 准备数据
```bash
# 1. 创建新批次目录
mkdir data/raw/batch_002
mkdir data/annotations/batch_002

# 2. 放入文件
# - 图片 → data/raw/batch_002/
# - 标注 → data/annotations/batch_002/annotator1/
```

### Step 2: 自动处理
```bash
# 一键添加并验证
python scripts/add_new_batch.py --batch batch_002

# 先检查不执行（推荐第一次使用）
python scripts/add_new_batch.py --batch batch_002 --dry-run
```

### Step 3: 重新训练
```bash
# 查看数据统计
python scripts/show_data_stats.py --detailed

# 如果新增数据>50张，重新训练
START_PHASE1_IMPROVED_TRAINING.bat
```

---

## 📁 标准目录结构

```
data/
├── raw/
│   ├── batch_001/          ← 第一批（现有279张）
│   │   ├── dashboard_0001.png
│   │   └── dashboard_0279.png
│   │
│   └── batch_002/          ← 第二批（新增）
│       ├── dashboard_0280.png
│       └── dashboard_0XXX.png
│
└── annotations/
    ├── batch_001/          ← 对应第一批
    │   ├── annotator1/
    │   │   └── 0001-0069.xml
    │   └── ...
    │
    └── batch_002/          ← 对应第二批
        └── annotator1/
            └── 0280-0XXX.xml
```

---

## ⚙️ 常用命令

### 整理现有数据（首次使用）
```bash
# 将现有数据移动到batch_001结构
python scripts/organize_existing_data.py --dry-run  # 先预览
python scripts/organize_existing_data.py           # 确认后执行
```

### 查看数据统计
```bash
# 基础统计
python scripts/show_data_stats.py

# 详细分析（含优先级建议）
python scripts/show_data_stats.py --detailed

# 导出报告
python scripts/show_data_stats.py --detailed --export report.txt
```

### 添加新批次
```bash
# 检查模式（推荐先运行）
python scripts/add_new_batch.py --batch batch_XXX --dry-run

# 正式添加
python scripts/add_new_batch.py --batch batch_XXX
```

---

## 📊 数据收集优先级

基于当前模型性能（mAP50 = 51.2%），优先收集：

### 🔴 紧急（样本<10）
| 类别 | 当前 | 目标 | 缺口 |
|------|------|------|------|
| Pie chart | 1个 | 30+ | +29 |
| Radar chart | 1个 | 30+ | +29 |
| Timeline | 1个 | 30+ | +29 |
| Heatmap | 5个 | 50+ | +45 |
| Scatter plot | 11个 | 40+ | +29 |
| Line chart | 17个 | 60+ | +43 |

### 🟡 重要（样本10-20）
适当补充，目标各40+

### 🟢 充足（样本≥50）
维持当前水平

---

## ✅ 数据质量检查清单

### 添加前检查
- [ ] 图片格式为PNG
- [ ] 图片命名：`dashboard_XXXX.png`（编号连续）
- [ ] 图片清晰无损坏
- [ ] 标注文件格式正确（CVAT XML）

### 添加后验证
```bash
# 运行自动验证
python scripts/add_new_batch.py --batch batch_XXX --dry-run
```

---

## 🎯 训练时机

### 建议重新训练的时机：
- ✅ 新增数据 ≥ 50张
- ✅ 关键类别（Line/Heatmap等）增加 ≥ 20张
- ✅ 每周/每两周固定训练一次

### 快速训练：
```bash
START_PHASE1_IMPROVED_TRAINING.bat
```

---

## ❓ 常见问题

### Q: 现有数据如何整理？
```bash
python scripts/organize_existing_data.py
```

### Q: 如何查看需要优先收集哪些类别？
```bash
python scripts/show_data_stats.py --detailed
# 查看"🎯 数据收集优先级分析"部分
```

### Q: 批次编号如何确定？
查看 `data/raw/` 目录，找到最大编号+1
```bash
# 如果有 batch_001, batch_002
# 新批次就是 batch_003
```

### Q: 可以修改已有批次的数据吗？
不推荐！应该：
- 保持已有批次不变（便于追溯）
- 新增数据放到新批次
- 如需修正错误标注，创建新批次并标记

### Q: 训练完成后如何判断是否有提升？
查看训练日志中的 mAP50 和 Recall：
- mAP50 > 51.2% ✅ 有提升
- mAP50 < 51.2% ⚠️ 可能数据质量问题
- 重点关注弱类别（Line/Heatmap）的指标

---

## 📞 获取帮助

- **详细文档**: `data/README_数据管理规范.md`
- **GitHub Issues**: https://github.com/Keria04/DashboradGrounding/issues

---

**版本**: v1.0  
**更新日期**: 2025-10-16

